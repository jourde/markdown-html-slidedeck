<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Markdown Slide Deck</title>
  <style>
    :root {
      --bg-a: #ffffff;
      --bg-b: #f2f5fa;
      --text: #1e2430;
      --muted: #6a7588;
      --accent: #1c7ed6;
      --accent-hover: #176ab5;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      color: var(--text);
      font-family: "Avenir Next", "Segoe UI", "Helvetica Neue", sans-serif;
      background: radial-gradient(circle at top left, var(--bg-a) 0%, var(--bg-b) 100%);
      overflow: hidden;
    }

    .app {
      height: 100vh;
      width: 100%;
      padding: clamp(20px, 4vw, 44px);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0;
    }

    .upload-cta {
      border: 0;
      border-radius: 999px;
      background: var(--accent);
      color: #fff;
      padding: 11px 18px;
      font-size: 0.95rem;
      font-weight: 700;
      line-height: 1;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      box-shadow: 0 10px 20px rgba(28, 126, 214, 0.22);
      transition: background 140ms ease, transform 140ms ease;
    }

    .upload-cta:hover {
      background: var(--accent-hover);
      transform: translateY(-1px);
    }

    .upload-cta:focus-visible {
      outline: 3px solid rgba(28, 126, 214, 0.3);
      outline-offset: 2px;
    }

    .upload-cta svg {
      width: 18px;
      height: 18px;
      fill: currentColor;
    }

    .slide {
      width: min(1280px, 100%);
      flex: 1;
      min-height: 0;
      overflow: auto;
      padding: 0;
      line-height: 1.5;
      font-size: clamp(1rem, 1.18vw, 1.4rem);
    }

    .slide-center {
      min-height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: clamp(10px, 2vw, 24px);
    }

    .slide.is-tall .slide-center {
      align-items: flex-start;
    }

    .slide-content {
      width: min(1100px, 100%);
    }

    .train-map {
      width: min(1100px, 100%);
      height: 58px;
      display: none;
      align-items: center;
      justify-content: center;
      position: relative;
      padding: 12px 22px 10px;
    }

    .app.train-visible .train-map {
      display: flex;
    }

    .train-track {
      position: absolute;
      left: 24px;
      right: 24px;
      height: 2px;
      background: #d5ddea;
      border-radius: 999px;
      top: 50%;
      transform: translateY(-50%);
    }

    .station-list {
      position: relative;
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1;
    }

    .station {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      border: 2px solid #c5cfdf;
      background: #fff;
      cursor: pointer;
      transition: transform 120ms ease, border-color 120ms ease, background 120ms ease;
    }

    .station:hover {
      transform: translateY(-1px);
      border-color: #8ea3c0;
    }

    .station.past {
      border-color: #8fbde9;
      background: #d8ebfd;
    }

    .station.active {
      border-color: var(--accent);
      background: var(--accent);
      box-shadow: 0 0 0 4px rgba(28, 126, 214, 0.15);
    }

    .map-toggle {
      position: fixed;
      right: 16px;
      bottom: 14px;
      border: 0;
      border-radius: 999px;
      background: #ffffff;
      color: #2e3c54;
      padding: 9px 12px;
      font-size: 0.8rem;
      font-weight: 700;
      line-height: 1;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(21, 34, 54, 0.14);
      transition: transform 120ms ease, box-shadow 120ms ease;
    }

    .map-toggle:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(21, 34, 54, 0.18);
    }

    .map-toggle:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .slide h1,
    .slide h2,
    .slide h3 {
      margin-top: 0;
      line-height: 1.12;
      letter-spacing: -0.01em;
    }

    .slide h1 {
      font-size: clamp(2rem, 3vw, 3.2rem);
    }

    .slide h2 {
      font-size: clamp(1.6rem, 2.4vw, 2.4rem);
    }

    .slide h3 {
      font-size: clamp(1.3rem, 1.8vw, 1.7rem);
    }

    .slide p,
    .slide li,
    .slide blockquote,
    .slide pre {
      margin: 0 0 0.8em;
    }

    .slide ul,
    .slide ol {
      padding-left: 1.4em;
    }

    .slide code {
      background: #ebf1f8;
      border-radius: 6px;
      padding: 0.08em 0.34em;
      font-size: 0.9em;
    }

    .slide pre {
      background: #edf3fa;
      border: 1px solid #d7e1ef;
      border-radius: 10px;
      padding: 0.9em;
      overflow: auto;
    }

    .slide pre code {
      background: transparent;
      padding: 0;
    }

    .slide blockquote {
      margin-left: 0;
      padding-left: 0.9em;
      border-left: 4px solid #cfe2fa;
      color: #3e4c64;
    }

    .empty {
      display: grid;
      place-items: center;
      height: 100%;
      text-align: center;
      color: var(--muted);
      font-size: clamp(1rem, 1.2vw, 1.2rem);
    }

    .empty strong {
      display: block;
      font-size: clamp(1.2rem, 2vw, 1.6rem);
      color: var(--text);
      margin-bottom: 8px;
    }

    .empty .upload-cta {
      margin-top: 14px;
    }

    #fileInput {
      display: none;
    }
  </style>
</head>
<body>
  <main class="app">
    <input id="fileInput" type="file" accept=".md,.markdown,text/markdown,text/plain" />
    <article id="slide" class="slide" aria-live="polite"></article>
    <nav id="trainMap" class="train-map" aria-label="Slide train map"></nav>
  </main>
  <button id="mapToggle" class="map-toggle" type="button" aria-label="Toggle slide train map">Show Map</button>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    const state = {
      slides: [],
      index: 0,
      showTrainMap: false
    };

    const appEl = document.querySelector(".app");
    const slideEl = document.getElementById("slide");
    const fileInputEl = document.getElementById("fileInput");
    const trainMapEl = document.getElementById("trainMap");
    const mapToggleEl = document.getElementById("mapToggle");

    function escapeHtml(input) {
      return input
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;");
    }

    if (window.marked) {
      window.marked.setOptions({
        gfm: true,
        breaks: false
      });
    }

    function markdownToHtml(markdown) {
      const normalized = markdown.replace(/\r\n?/g, "\n");
      if (window.marked && typeof window.marked.parse === "function") {
        return window.marked.parse(normalized);
      }
      return `<pre>${escapeHtml(normalized)}</pre>`;
    }

    function parseSlides(markdown) {
      const rawSlides = markdown
        .replace(/\r\n?/g, "\n")
        .split(/^---\s*$/m)
        .map((chunk) => chunk.trim())
        .filter(Boolean);

      return rawSlides.map((raw) => {
        const noteSeparator = raw.split(/^--\s*$/m);
        const content = noteSeparator[0].trim();
        return {
          content,
          notes: noteSeparator.slice(1).join("\n").trim(),
          html: markdownToHtml(content)
        };
      });
    }

    function renderSlide() {
      if (!state.slides.length) {
        slideEl.innerHTML = `
          <div class="empty">
            <div>
              <strong>Upload a markdown file</strong>
              <div>Use <code>---</code> for slides and <code>--</code> for speaker notes.</div>
              <button class="upload-cta" type="button" data-action="upload" aria-label="Import markdown file">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8zm-2 18H8v-2h4zm2-4H8v-2h6zm0-4H8v-2h6zm-1-3V3.5L18.5 9z"/>
                </svg>
                Import .md File
              </button>
            </div>
          </div>
        `;
        renderTrainMap();
        return;
      }

      slideEl.innerHTML = `
        <div class="slide-center">
          <div class="slide-content">${state.slides[state.index].html || "<p></p>"}</div>
        </div>
      `;
      updateSlideAlignment();
      slideEl.scrollTop = 0;
      renderTrainMap();
    }

    function updateSlideAlignment() {
      const centerEl = slideEl.querySelector(".slide-center");
      const contentEl = slideEl.querySelector(".slide-content");
      if (!centerEl || !contentEl) {
        slideEl.classList.remove("is-tall");
        return;
      }

      const styles = window.getComputedStyle(centerEl);
      const padTop = parseFloat(styles.paddingTop) || 0;
      const padBottom = parseFloat(styles.paddingBottom) || 0;
      const availableHeight = slideEl.clientHeight - padTop - padBottom;
      const contentHeight = contentEl.offsetHeight;
      slideEl.classList.toggle("is-tall", contentHeight > availableHeight);
    }

    function goNext() {
      if (state.index < state.slides.length - 1) {
        state.index += 1;
        renderSlide();
      }
    }

    function goPrev() {
      if (state.index > 0) {
        state.index -= 1;
        renderSlide();
      }
    }

    function renderTrainMap() {
      trainMapEl.innerHTML = "";

      if (!state.slides.length) {
        state.showTrainMap = false;
        appEl.classList.remove("train-visible");
        mapToggleEl.textContent = "Show Map";
        mapToggleEl.disabled = true;
        return;
      }

      mapToggleEl.disabled = false;
      mapToggleEl.textContent = state.showTrainMap ? "Hide Map" : "Show Map";
      appEl.classList.toggle("train-visible", state.showTrainMap);
      if (!state.showTrainMap) {
        updateSlideAlignment();
        return;
      }

      const track = document.createElement("div");
      track.className = "train-track";
      trainMapEl.appendChild(track);

      const stationList = document.createElement("div");
      stationList.className = "station-list";

      state.slides.forEach((_, idx) => {
        const station = document.createElement("button");
        station.type = "button";
        station.className = "station";
        if (idx < state.index) {
          station.classList.add("past");
        }
        if (idx === state.index) {
          station.classList.add("active");
        }
        station.setAttribute("aria-label", `Go to slide ${idx + 1}`);
        station.title = `Slide ${idx + 1}`;
        station.addEventListener("click", () => {
          state.index = idx;
          renderSlide();
        });
        stationList.appendChild(station);
      });

      trainMapEl.appendChild(stationList);
      updateSlideAlignment();
    }

    function handleUpload(event) {
      const file = event.target.files?.[0];
      if (!file) {
        return;
      }

      const reader = new FileReader();
      reader.onload = () => {
        const text = String(reader.result || "");
        state.slides = parseSlides(text);
        state.index = 0;
        renderSlide();
      };
      reader.readAsText(file);
      event.target.value = "";
    }

    slideEl.addEventListener("click", (event) => {
      const target = event.target.closest("[data-action='upload']");
      if (target) {
        fileInputEl.click();
      }
    });
    fileInputEl.addEventListener("change", handleUpload);
    mapToggleEl.addEventListener("click", () => {
      if (!state.slides.length) {
        return;
      }
      state.showTrainMap = !state.showTrainMap;
      renderTrainMap();
    });

    document.addEventListener("keydown", (event) => {
      if (event.key === "ArrowRight" || event.key === "PageDown" || event.key === " ") {
        event.preventDefault();
        goNext();
      }
      if (event.key === "ArrowLeft" || event.key === "PageUp") {
        event.preventDefault();
        goPrev();
      }
      if (event.key.toLowerCase() === "m" && state.slides.length) {
        state.showTrainMap = !state.showTrainMap;
        renderTrainMap();
      }
    });

    window.addEventListener("resize", updateSlideAlignment);

    renderSlide();
  </script>
</body>
</html>
